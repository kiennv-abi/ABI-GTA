export function vehicleScript(){var t=pc.createScript("vehicle");t.attributes.add("wheels",{type:"entity",array:!0,title:"Wheels"}),t.attributes.add("maxEngineForce",{type:"number",default:7e3,title:"Max Engine Force"}),t.attributes.add("maxBrakingForce",{type:"number",default:100,title:"Max Braking Force"}),t.attributes.add("maxSteering",{type:"number",default:.3,title:"Max Steering"}),Object.defineProperty(t.prototype,"speed",{get:function(){return this.vehicle?this.vehicle.getCurrentSpeedKmHour():0}}),t.prototype.initialize=function(){var t=this.entity.rigidbody.body,e=this.app.systems.rigidbody.dynamicsWorld,s=new Ammo.btVehicleTuning,i=new Ammo.btDefaultVehicleRaycaster(e),n=new Ammo.btRaycastVehicle(s,t,i);n.setCoordinateSystem(0,1,2),t.setActivationState(4);var r=new Ammo.btVector3(-1,0,0),o=new Ammo.btVector3(0,-1,0),a=new Ammo.btVector3(0,0,0);this.wheels.forEach((function(t){var e=t.script.vehicleWheel,i=e.frictionSlip,h=e.isFront,d=e.radius,u=e.rollInfluence,c=e.suspensionCompression,l=e.suspensionDamping,p=e.suspensionRestLength,b=e.suspensionStiffness,y=t.getLocalPosition();a.setValue(y.x,y.y,y.z);var f=n.addWheel(a,o,r,p,d,s,h);f.set_m_suspensionStiffness(b),f.set_m_wheelsDampingRelaxation(l),f.set_m_wheelsDampingCompression(c),f.set_m_frictionSlip(i),f.set_m_rollInfluence(u)}),this),Ammo.destroy(r),Ammo.destroy(o),Ammo.destroy(a),e.addAction(n),this.vehicle=n,this.engineForce=0,this.brakingForce=0,this.steering=0,this.on("enable",(function(){e.addAction(n)})),this.on("disable",(function(){e.removeAction(n)})),this.on("destroy",(function(){e.removeAction(n),Ammo.destroy(i),Ammo.destroy(n)})),this.on("vehicle:controls",(function(t,e){this.steering=pc.math.lerp(this.steering,t*this.maxSteering,.3),e>0?(this.brakingForce=0,this.engineForce=this.maxEngineForce):e<0?(this.brakingForce=0,this.engineForce=-this.maxEngineForce):(this.brakingForce=this.maxBrakingForce,this.engineForce=0)}))},t.prototype.update=function(t){var e,s=this.vehicle;this.entity.rigidbody.body.setActivationState(4),s.setSteeringValue(this.steering,0),s.setSteeringValue(this.steering,1),s.applyEngineForce(this.engineForce,2),s.setBrake(this.brakingForce,2),s.applyEngineForce(this.engineForce,3),s.setBrake(this.brakingForce,3);var i=s.getNumWheels();for(e=0;e<i;e++){s.updateWheelTransform(e,!0);var n=this.vehicle.getWheelTransformWS(e),r=(n.getOrigin(),n.getRotation());this.wheels[e].setRotation(r.x(),r.y(),r.z(),r.w())}};var e=pc.createScript("vehicleWheel");e.attributes.add("isFront",{type:"boolean",default:!0,title:"Front Wheel"}),e.attributes.add("radius",{type:"number",default:.4,title:"Radius"}),e.attributes.add("width",{type:"number",default:.4,title:"Width"}),e.attributes.add("suspensionStiffness",{type:"number",default:10,title:"Suspension Stiffness"}),e.attributes.add("suspensionDamping",{type:"number",default:2.3,title:"Suspension Damping"}),e.attributes.add("suspensionCompression",{type:"number",default:4.4,title:"Suspension Compression"}),e.attributes.add("suspensionRestLength",{type:"number",default:.4,title:"Suspension Rest Length"}),e.attributes.add("rollInfluence",{type:"number",default:.2,title:"Roll Influence"}),e.attributes.add("frictionSlip",{type:"number",default:1e3,title:"Friction Slip"}),e.attributes.add("debugRender",{type:"boolean",default:!1,title:"Debug Render"}),e.prototype.initialize=function(){var t=function(t,e){var s=new pc.Entity;return s.addComponent("model",{type:"cylinder",castShadows:!0}),s.setLocalEulerAngles(0,0,90),s.setLocalScale(2*t,e,2*t),s};this.debugRender&&(this.debugWheel=t(this.radius,this.width),this.entity.addChild(this.debugWheel)),this.on("attr:debugRender",(function(e,s){e?(this.debugWheel=t(this.radius,this.width),this.entity.addChild(this.debugWheel)):this.debugWheel&&(this.debugWheel.destroy(),this.debugWheel=null)}))};var s=pc.createScript("vehicleControls");s.attributes.add("targetVehicle",{type:"entity",title:"Target Vehicle"}),s.attributes.add("leftButton",{type:"entity",title:"Left Button"}),s.attributes.add("rightButton",{type:"entity",title:"Right Button"}),s.attributes.add("forwardButton",{type:"entity",title:"Forward Button"}),s.attributes.add("reverseButton",{type:"entity",title:"Reverse Button"}),s.prototype.initialize=function(){this.leftButtonPressed=!1,this.rightButtonPressed=!1,this.upButtonPressed=!1,this.downButtonPressed=!1,this.leftKeyPressed=!1,this.rightKeyPressed=!1,this.upKeyPressed=!1,this.downKeyPressed=!1,this.leftButton&&(this.leftButton.enabled=pc.platform.mobile,this.leftButton.button.on("pressedstart",(function(){this.leftButtonPressed=!0}),this),this.leftButton.button.on("pressedend",(function(){this.leftButtonPressed=!1}),this)),this.rightButton&&(this.rightButton.enabled=pc.platform.mobile,this.rightButton.button.on("pressedstart",(function(){this.rightButtonPressed=!0}),this),this.rightButton.button.on("pressedend",(function(){this.rightButtonPressed=!1,console.log(1231212312)}),this)),this.forwardButton&&(this.forwardButton.enabled=pc.platform.mobile,this.forwardButton.button.on("pressedstart",(function(){this.upButtonPressed=!0}),this),this.forwardButton.button.on("pressedend",(function(){this.upButtonPressed=!1}),this)),this.reverseButton&&(this.reverseButton.enabled=pc.platform.mobile,this.reverseButton.button.on("pressedstart",(function(){this.downButtonPressed=!0}),this),this.reverseButton.button.on("pressedend",(function(){this.downButtonPressed=!1}),this)),this.app.keyboard.on("keydown",(function(t){switch(t.key){case pc.KEY_A:case pc.KEY_LEFT:this.leftKeyPressed=!0;break;case pc.KEY_D:case pc.KEY_RIGHT:this.rightKeyPressed=!0;break;case pc.KEY_W:case pc.KEY_UP:this.upKeyPressed=!0;break;case pc.KEY_S:case pc.KEY_DOWN:this.downKeyPressed=!0}}),this),this.app.keyboard.on("keyup",(function(t){switch(t.key){case pc.KEY_A:case pc.KEY_LEFT:this.leftKeyPressed=!1;break;case pc.KEY_D:case pc.KEY_RIGHT:this.rightKeyPressed=!1;break;case pc.KEY_W:case pc.KEY_UP:this.upKeyPressed=!1;break;case pc.KEY_S:case pc.KEY_DOWN:this.downKeyPressed=!1}}),this)},s.prototype.update=function(t){var e=this.targetVehicle?this.targetVehicle:this.entity;if(e){var s=0,i=0;(this.leftButtonPressed||this.leftKeyPressed)&&s++,(this.rightButtonPressed||this.rightKeyPressed)&&s--,(this.upButtonPressed||this.upKeyPressed)&&i++,(this.downButtonPressed||this.downKeyPressed)&&i--,e.script.vehicle.fire("vehicle:controls",s,i)}}}